{% extends "base.html" %} {% block title %}Dashboard - Absensi Face
Recognition{% endblock %} {% block content %}
<div class="container">
  <div class="page-header">
    <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
    <p class="subtitle">Ringkasan absensi hari ini - {{ stats.date }}</p>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card blue">
      <div class="stat-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-info">
        <h3>{{ stats.total_employees }}</h3>
        <p>Total Pegawai</p>
      </div>
    </div>

    <div class="stat-card green">
      <div class="stat-icon">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="stat-info">
        <h3>{{ stats.present_today }}</h3>
        <p>Hadir Hari Ini</p>
      </div>
    </div>

    <div class="stat-card red">
      <div class="stat-icon">
        <i class="fas fa-user-times"></i>
      </div>
      <div class="stat-info">
        <h3>{{ stats.absent_today }}</h3>
        <p>Belum Absen</p>
      </div>
    </div>

    <div class="stat-card purple">
      <div class="stat-icon">
        <i class="fas fa-percentage"></i>
      </div>
      <div class="stat-info">
        <h3>
          {% if stats.total_employees > 0 %}{{ ((stats.present_today /
          stats.total_employees) * 100)|round(1) }}%{% else %}0%{% endif %}
        </h3>
        <p>Persentase Kehadiran</p>
      </div>
    </div>
  </div>

  <!-- Today's Attendance -->
  <div class="card">
    <div class="card-header">
      <h2><i class="fas fa-list"></i> Absensi Hari Ini</h2>
      <button onclick="refreshAttendance()" class="btn btn-primary btn-sm">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>
    <div class="card-body">
      {% if attendance %}
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>ID Pegawai</th>
              <th>Nama</th>
              <th>Check In</th>
              <th>Check Out</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="attendance-tbody">
            {% for record in attendance %}
            <tr>
              <td>{{ record[0] }}</td>
              <td>{{ record[1] }}</td>
              <td>{{ record[2].split('.')[0] if record[2] else '-' }}</td>
              <td>{{ record[3].split('.')[0] if record[3] else '-' }}</td>
              <td><span class="badge badge-success">{{ record[4] }}</span></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <p>Belum ada absensi hari ini</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  function refreshAttendance() {
    fetch("/api/attendance/today")
      .then((response) => response.json())
      .then((data) => {
        const tbody = document.getElementById("attendance-tbody");
        tbody.innerHTML = "";

        data.forEach((record) => {
          const row = `
                    <tr>
                        <td>${record.employee_id}</td>
                        <td>${record.name}</td>
                        <td>${
                          record.check_in ? record.check_in.split(".")[0] : "-"
                        }</td>
                        <td>${
                          record.check_out
                            ? record.check_out.split(".")[0]
                            : "-"
                        }</td>
                        <td><span class="badge badge-success">${
                          record.status
                        }</span></td>
                    </tr>
                `;
          tbody.innerHTML += row;
        });
      });
  }
</script>
{% endblock %}
